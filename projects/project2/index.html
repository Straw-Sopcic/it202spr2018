
<!DOCTYPE html>

<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <title>psSearch</title>

        <!--CUSTOM FONTS-->
        <link href="https://fonts.googleapis.com/css?family=Sarina" rel="stylesheet">
        <link href="themify-icons.css"
              type="text/css"
              rel="stylesheet"/>
        <!--font-family: 'Sarina', cursive;-->

        <!--STYLE SHEETS-->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
              integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
              crossorigin="anonymous">
        <link href = "project2Style.css"
		  type = "text/css"
		  rel = "stylesheet" />
    </head>



    <body>

        <div id="compNav">
        <ul>
            <li ><p class="active" id="mainTitle" >psSearch</p></li>
            <li class="customDropDown">
                <p class="dropbtn">Public School Search <span class="arrowIcon ti-angle-right" > </span></p>
                <div class="dropdown-content">
                    <select class="dropList" id="sel1" multiple>

                    </select>
                </div>
            </li>
            <li style="float:right;"><button href="" class="searchButton" id="btn1">Search</button></li>
        </ul>
        </div>

        <div id="phoneNav">
            <div class="container-fluid" style="padding-right: 0px; padding-left: 0px;">
                <p class="active" id="mainTitleMobile" href="">psSearch</p>
            </div>
            <div class="container-fluid" style="padding-right: 0px; padding-left: 0px;">
            <ul>
            <li class="customDropDown">
                <p class="dropbtn">Public School Search <span class="ti-angle-right arrowIcon" > </span></p>
                <div class="dropdown-content">
                    <select class="dropList" id="sel2" multiple>

                    </select>
                </div>
            </li>
            <li style="float:right;"><button href="" class="searchButton" id="btn2">Search</button></li>
        </ul>
                </div>
        </div>

        <div class="container-fluid" id="results">
        </div>

        <div id="map"></div>


        <div>Icons made by <a href="http://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>



        <script
              src="http://code.jquery.com/jquery-3.3.1.min.js"
              integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
              crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"
                integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
                crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"
                integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
                crossorigin="anonymous"></script>

        <script>
            var searchParams= [];
            var baseLink = 'https://data.cityofchicago.org/resource/76dk-7ieb.json?$where=school_type IN (';

            // Create a <script> tag and set the USGS URL as the source.
            var script = document.createElement('script');

            function getHMap(){
                baseLink = 'https://data.cityofchicago.org/resource/76dk-7ieb.json?$where=school_type IN (';
                $.each(searchParams, function(i,v){ //populate link with needed params.
                          baseLink = baseLink + '\'' + v + '\'';
                      });
                baseLink = baseLink + ')';

                $.get(baseLink)
                  .done( function(response){
                     console.log(searchParams);
                     eqfeed_callback(response);

                    $( "#results" ).empty();
                      $.each(response, function(i,v){
                          $("#results").append('<h4 style="font-size:10px;"><b>Name:</b> ' + v.long_name + '\t-\t<b>Address:</b> ' +
                                v.address + '</h4>');

                      });

                  })
            }

            function getRandomColor() {
                  var letters = '0123456789ABCDEF';
                  var color = '#';
                  for (var i = 0; i < 6; i++) {
                        color += letters[Math.floor(Math.random() * 16)];
                  }
                  return color;
            }

            $(document).ready(function(){
                $(".customDropDown").mouseenter(function(){
                    $(".arrowIcon").removeClass("ti-angle-right");
                    $(".arrowIcon").addClass("ti-angle-down");
                });

                 $(".customDropDown").mouseleave(function(){
                     $(".arrowIcon").removeClass("ti-angle-down");
                    $(".arrowIcon").addClass("ti-angle-right");
                });

                $.get('https://data.cityofchicago.org/resource/76dk-7ieb.json?$select=school_type%20&$group=school_type')
                  .done( function(response){
                      console.log(response);
                      $.each(response, function(i,v){
                          $("<option >" + v.school_type + "</option>").appendTo(".dropList");
                      });

                  })

                $( "#btn1" ).click(function() {
                    searchParams= [];
                    $('#sel1 > option').each(function () {
                        console.log(this.selected,this.value);
                        if(this.selected){
                            searchParams.push(this.value);
                        }

                    });
                    getHMap();
                });

                $( "#btn2" ).click(function() {
                    $('sel2 > option').each(function () {
                       searchParams= [];
                       console.log(this.selected,this.value);
                       if(this.selected){
                            searchParams.push(this.value);
                        }
                    });
                    getHMap();

                });
            });

            /****************Map Code********/


            function initMap() {
                var uluru = {lat: -25.363, lng: 131.044};
                var map = new google.maps.Map(document.getElementById('map'), {
                  zoom: 4,
                  center: uluru
                });
                var marker = new google.maps.Marker({
                  position: uluru,
                  map: map
                });
            }


            function eqfeed_callback(results) {
              console.log(results);
              var heatmapData = [];
             $.each(results, function(i,v){
                 if(v.hasOwnProperty("latitude") && v.hasOwnProperty("longitude")){
                        var latLng = new google.maps.LatLng(parseFloat(v.school_latitude), parseFloat(v.school_longitude));
                        heatmapData.push(latLng);
                 }
             });

            }
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC3XToRNEGfSvyk0bIbyi-GXwdjuVQGkZQ&callback=initMap">
    </script>
    </body>
</html>
